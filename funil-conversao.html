<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WEKOTA ‚Äî Fluxo de Convers√£o (Prot√≥tipo)</title>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S285WX7BLZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-S285WX7BLZ');
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --navy: #0F2B3C;
      --navy-deep: #091D2A;
      --navy-mid: #0E2435;
      --teal: #4ECBA5;
      --teal-hover: #3DB893;
      --teal-light: #6EDBB8;
      --teal-glow: rgba(78, 203, 165, 0.10);
      --teal-glow-strong: rgba(78, 203, 165, 0.18);
      --teal-border: rgba(78, 203, 165, 0.25);
      --slate: #8FA3B0;
      --white: #FFFFFF;
      --text: #C8D6DE;
      --text-bright: #E8EFF3;
      --red: #E74C3C;
      --red-soft: rgba(231, 76, 60, 0.1);
      --gold: #F4D03F;
      --divider: rgba(255,255,255,0.06);
      --card-bg: rgba(255,255,255,0.035);
      --card-border: rgba(255,255,255,0.08);
      --card-hover: rgba(255,255,255,0.06);
      --input-bg: rgba(255,255,255,0.05);
      --input-border: rgba(255,255,255,0.12);
      --input-focus: rgba(78, 203, 165, 0.4);
      --whatsapp: #25D366;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--navy-deep);
      color: var(--text);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    /* ‚îÄ‚îÄ PROTOTYPE BANNER ‚îÄ‚îÄ */
    .proto-banner {
      background: linear-gradient(90deg, var(--teal), #3DB893);
      color: var(--navy-deep);
      text-align: center;
      padding: 0.6rem 1rem;
      font-size: 0.78rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      position: fixed; top: 0; left: 0; right: 0; z-index: 999;
    }

    /* ‚îÄ‚îÄ CONTAINER ‚îÄ‚îÄ */
    .funnel-wrap {
      max-width: 480px;
      margin: 0 auto;
      padding: 60px 20px 40px;
      min-height: 100vh;
      position: relative;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    .funnel-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 1rem 0 1.5rem;
    }
    .funnel-logo {
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-weight: 800; font-size: 1.2rem; color: var(--white);
      letter-spacing: -0.02em;
    }
    .funnel-logo span { color: var(--teal); }
    .funnel-close {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      color: var(--slate);
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .funnel-close:hover { background: var(--card-hover); color: var(--white); }

    /* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
    .progress-wrap {
      margin-bottom: 2rem;
      opacity: 0;
      transition: opacity 0.4s;
    }
    .progress-wrap.visible { opacity: 1; }
    .progress-steps {
      display: flex; gap: 6px; margin-bottom: 0.5rem;
    }
    .progress-dot {
      flex: 1; height: 3px;
      background: var(--divider);
      border-radius: 3px;
      transition: background 0.5s;
    }
    .progress-dot.active { background: var(--teal); }
    .progress-dot.done { background: var(--teal); opacity: 0.5; }
    .progress-label {
      font-size: 0.72rem; color: var(--slate);
      font-weight: 600; letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
    .screen {
      display: none;
      animation: screenIn 0.45s cubic-bezier(0.22, 0.61, 0.36, 1) both;
    }
    .screen.active { display: block; }
    @keyframes screenIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ‚îÄ‚îÄ TYPOGRAPHY ‚îÄ‚îÄ */
    .screen-title {
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 1.65rem; font-weight: 800;
      color: var(--white); line-height: 1.2;
      letter-spacing: -0.03em;
      margin-bottom: 0.6rem;
    }
    .screen-sub {
      font-size: 0.95rem; color: var(--slate);
      line-height: 1.6; margin-bottom: 1.75rem;
    }
    .screen-sub strong { color: var(--text-bright); font-weight: 600; }

    /* ‚îÄ‚îÄ SPLIT CTA (Step 0) ‚îÄ‚îÄ */
    .split-choices {
      display: flex; flex-direction: column; gap: 12px;
      margin-top: 1.5rem;
    }
    .split-btn {
      position: relative;
      display: flex; align-items: center; gap: 1rem;
      padding: 1.35rem 1.5rem;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s;
      border: none; text-align: left;
      font-family: 'DM Sans', sans-serif;
    }
    .split-btn-primary {
      background: linear-gradient(135deg, var(--teal), #3DB893);
      color: var(--navy-deep);
      box-shadow: 0 8px 32px rgba(78, 203, 165, 0.25);
    }
    .split-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(78, 203, 165, 0.35);
    }
    .split-btn-secondary {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      color: var(--text);
    }
    .split-btn-secondary:hover {
      background: var(--card-hover);
      border-color: var(--teal-border);
    }
    .split-icon {
      width: 48px; height: 48px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 14px;
      font-size: 1.4rem;
      flex-shrink: 0;
    }
    .split-btn-primary .split-icon {
      background: rgba(15, 43, 60, 0.15);
    }
    .split-btn-secondary .split-icon {
      background: var(--teal-glow);
    }
    .split-text h3 {
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 1.05rem; font-weight: 700;
      margin-bottom: 0.15rem;
    }
    .split-btn-primary .split-text h3 { color: var(--navy-deep); }
    .split-btn-secondary .split-text h3 { color: var(--white); }
    .split-text p {
      font-size: 0.82rem; opacity: 0.8;
      line-height: 1.4;
    }
    .split-badge {
      position: absolute; top: -8px; right: 16px;
      background: var(--navy-deep);
      color: var(--teal);
      font-size: 0.65rem; font-weight: 700;
      padding: 0.2rem 0.65rem;
      border-radius: 6px;
      border: 1px solid var(--teal-border);
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    /* ‚îÄ‚îÄ FORM ELEMENTS ‚îÄ‚îÄ */
    .form-group {
      margin-bottom: 1rem;
    }
    .form-label {
      display: block;
      font-size: 0.78rem; font-weight: 600;
      color: var(--slate);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      margin-bottom: 0.45rem;
    }
    .form-input {
      width: 100%;
      padding: 0.9rem 1rem;
      background: var(--input-bg);
      border: 1.5px solid var(--input-border);
      border-radius: 12px;
      color: var(--white);
      font-family: 'DM Sans', sans-serif;
      font-size: 1rem;
      transition: all 0.25s;
      outline: none;
    }
    .form-input::placeholder { color: rgba(143, 163, 176, 0.5); }
    .form-input:focus {
      border-color: var(--teal);
      background: rgba(78, 203, 165, 0.05);
      box-shadow: 0 0 0 3px var(--input-focus);
    }
    .form-row {
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
    }
    .form-select {
      width: 100%;
      padding: 0.9rem 1rem;
      background: var(--input-bg);
      border: 1.5px solid var(--input-border);
      border-radius: 12px;
      color: var(--white);
      font-family: 'DM Sans', sans-serif;
      font-size: 1rem;
      outline: none;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238FA3B0' fill='none' stroke-width='1.5'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
    }
    .form-select option { background: var(--navy); color: var(--white); }

    /* ‚îÄ‚îÄ PRODUCT CARDS ‚îÄ‚îÄ */
    .product-cards {
      display: flex; flex-direction: column; gap: 10px;
      margin-bottom: 1.5rem;
    }
    .product-card {
      display: flex; align-items: center; gap: 1rem;
      padding: 1rem 1.25rem;
      background: var(--card-bg);
      border: 2px solid var(--card-border);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.25s;
    }
    .product-card:hover { background: var(--card-hover); }
    .product-card.selected {
      border-color: var(--teal);
      background: var(--teal-glow);
    }
    .product-card .pc-radio {
      width: 22px; height: 22px;
      border-radius: 50%;
      border: 2px solid var(--input-border);
      flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.25s;
    }
    .product-card.selected .pc-radio {
      border-color: var(--teal);
      background: var(--teal);
    }
    .product-card.selected .pc-radio::after {
      content: '‚úì'; color: var(--navy-deep);
      font-size: 0.75rem; font-weight: 700;
    }
    .pc-info h4 {
      font-size: 0.95rem; font-weight: 700;
      color: var(--white); margin-bottom: 0.15rem;
    }
    .pc-info p {
      font-size: 0.8rem; color: var(--slate);
    }
    .pc-info .pc-price {
      color: var(--teal); font-weight: 700;
    }
    .pc-badge {
      margin-left: auto;
      background: var(--teal-glow);
      border: 1px solid var(--teal-border);
      color: var(--teal);
      font-size: 0.65rem; font-weight: 700;
      padding: 0.2rem 0.55rem;
      border-radius: 6px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      white-space: nowrap;
    }

    /* ‚îÄ‚îÄ DURATION CARDS ‚îÄ‚îÄ */
    .duration-cards {
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
      margin-bottom: 1.5rem;
    }
    .dur-card {
      padding: 1.25rem;
      background: var(--card-bg);
      border: 2px solid var(--card-border);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.25s;
      text-align: center;
      position: relative;
    }
    .dur-card:hover { background: var(--card-hover); }
    .dur-card.selected {
      border-color: var(--teal);
      background: var(--teal-glow);
    }
    .dur-card .dur-months {
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 2rem; font-weight: 800;
      color: var(--white);
    }
    .dur-card .dur-label {
      font-size: 0.78rem; color: var(--slate);
      font-weight: 500; margin-bottom: 0.6rem;
    }
    .dur-card .dur-price {
      font-size: 1rem; font-weight: 700;
      color: var(--teal);
    }
    .dur-card .dur-price-label {
      font-size: 0.72rem; color: var(--slate);
    }
    .dur-card .dur-upgrade {
      margin-top: 0.6rem;
      font-size: 0.68rem;
      color: var(--gold);
      font-weight: 600;
    }
    .dur-badge {
      position: absolute; top: -9px; left: 50%; transform: translateX(-50%);
      background: var(--teal);
      color: var(--navy-deep);
      font-size: 0.6rem; font-weight: 800;
      padding: 0.2rem 0.7rem;
      border-radius: 6px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      white-space: nowrap;
    }

    /* ‚îÄ‚îÄ KYC UPLOAD ‚îÄ‚îÄ */
    .upload-zone {
      border: 2px dashed var(--input-border);
      border-radius: 16px;
      padding: 2rem 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 1rem;
    }
    .upload-zone:hover {
      border-color: var(--teal-border);
      background: var(--teal-glow);
    }
    .upload-zone.uploaded {
      border-color: var(--teal);
      border-style: solid;
      background: var(--teal-glow);
    }
    .upload-icon {
      font-size: 2rem; margin-bottom: 0.5rem;
    }
    .upload-zone h4 {
      font-size: 0.92rem; font-weight: 700;
      color: var(--white); margin-bottom: 0.25rem;
    }
    .upload-zone p {
      font-size: 0.8rem; color: var(--slate);
    }

    /* ‚îÄ‚îÄ POSITION REVEAL ‚îÄ‚îÄ */
    .reveal-container {
      text-align: center;
      padding: 2rem 0;
    }
    .reveal-ring {
      width: 160px; height: 160px;
      margin: 0 auto 1.5rem;
      border-radius: 50%;
      border: 3px solid var(--teal-border);
      display: flex; align-items: center; justify-content: center;
      position: relative;
      animation: ringPulse 2s ease-in-out infinite;
    }
    @keyframes ringPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(78,203,165,0.3); }
      50% { box-shadow: 0 0 0 20px rgba(78,203,165,0); }
    }
    .reveal-number {
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 4rem; font-weight: 800;
      color: var(--teal);
      animation: numberReveal 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) both;
      animation-delay: 0.5s;
      opacity: 0;
    }
    @keyframes numberReveal {
      from { opacity: 0; transform: scale(0.3); }
      to { opacity: 1; transform: scale(1); }
    }
    .reveal-label {
      font-size: 0.82rem; color: var(--slate);
      font-weight: 600; letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }
    .reveal-meaning {
      font-size: 1.1rem; color: var(--white);
      font-weight: 600; margin-bottom: 0.3rem;
    }
    .reveal-detail {
      font-size: 0.88rem; color: var(--slate);
    }

    /* ‚îÄ‚îÄ CONTRACT SUMMARY ‚îÄ‚îÄ */
    .contract-summary {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .cs-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--divider);
    }
    .cs-row:last-child { border-bottom: none; }
    .cs-label { font-size: 0.85rem; color: var(--slate); }
    .cs-value { font-size: 0.9rem; color: var(--white); font-weight: 600; }
    .cs-value.highlight-val { color: var(--teal); font-size: 1.05rem; }

    /* ‚îÄ‚îÄ PAYMENT METHODS ‚îÄ‚îÄ */
    .pay-methods {
      display: flex; flex-direction: column; gap: 8px;
      margin-bottom: 1.5rem;
    }
    .pay-method {
      display: flex; align-items: center; gap: 1rem;
      padding: 1rem 1.25rem;
      background: var(--card-bg);
      border: 2px solid var(--card-border);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.25s;
    }
    .pay-method:hover { background: var(--card-hover); }
    .pay-method.selected {
      border-color: var(--teal);
      background: var(--teal-glow);
    }
    .pay-icon {
      width: 42px; height: 42px;
      display: flex; align-items: center; justify-content: center;
      background: var(--input-bg);
      border-radius: 10px;
      font-size: 1.2rem;
      flex-shrink: 0;
    }
    .pay-method.selected .pay-icon {
      background: var(--teal-glow-strong);
    }
    .pay-info h4 {
      font-size: 0.92rem; font-weight: 700; color: var(--white);
    }
    .pay-info p {
      font-size: 0.75rem; color: var(--slate);
    }
    .pay-rec {
      margin-left: auto;
      font-size: 0.65rem; font-weight: 700;
      color: var(--teal);
      background: var(--teal-glow);
      padding: 0.2rem 0.5rem;
      border-radius: 5px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    /* ‚îÄ‚îÄ BANK DETAILS (TRANSFER) ‚îÄ‚îÄ */
    .bank-details-box {
      display: none;
      margin-top: 1rem;
      background: rgba(0,0,0,0.2);
      border: 1px solid var(--teal-border);
      border-radius: 12px;
      padding: 1.25rem;
      animation: fadeIn 0.3s ease;
    }
    .bank-details-box.active { display: block; }
    .bank-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--divider);
    }
    .bank-row:last-child { border-bottom: none; }
    .bank-label { font-size: 0.75rem; color: var(--slate); font-weight: 600; text-transform: uppercase; }
    .bank-val-wrap { display: flex; align-items: center; gap: 8px; }
    .bank-value { font-size: 0.85rem; color: var(--white); font-family: monospace; }
    .copy-btn {
      background: var(--teal-glow);
      border: 1px solid var(--teal-border);
      color: var(--teal);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .copy-btn:hover { background: var(--teal); color: var(--navy-deep); }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
    .btn-primary {
      width: 100%;
      padding: 1rem 1.5rem;
      background: linear-gradient(135deg, var(--teal), #3DB893);
      color: var(--navy-deep);
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 1rem; font-weight: 700;
      border: none; border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 6px 24px rgba(78, 203, 165, 0.2);
      letter-spacing: -0.01em;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 36px rgba(78, 203, 165, 0.3);
    }
    .btn-primary:active { transform: translateY(0); }
    .btn-secondary {
      width: 100%;
      padding: 0.85rem 1.5rem;
      background: transparent;
      color: var(--slate);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.88rem; font-weight: 600;
      border: 1px solid var(--card-border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.25s;
      margin-top: 0.6rem;
    }
    .btn-secondary:hover { border-color: var(--teal-border); color: var(--teal); }

    /* ‚îÄ‚îÄ TRUST BAR ‚îÄ‚îÄ */
    .trust-bar {
      display: flex; gap: 1.25rem; justify-content: center;
      margin: 2rem 0 1rem;
      flex-wrap: wrap;
    }
    .trust-item {
      display: flex; align-items: center; gap: 0.35rem;
      font-size: 0.72rem; color: var(--slate);
      font-weight: 500;
    }
    .trust-icon { color: var(--teal); font-size: 0.85rem; }

    /* ‚îÄ‚îÄ WHATSAPP FLOAT ‚îÄ‚îÄ */
    .wa-float {
      position: fixed; bottom: 24px; right: 24px;
      background: #25D366;
      color: white;
      padding: 1rem;
      border-radius: 9999px;
      box-shadow: 0 10px 25px -5px rgba(37, 211, 102, 0.4);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 100;
      border: none;
      cursor: pointer;
    }
    .wa-float:hover {
      background: #22c35e;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 20px 25px -5px rgba(37, 211, 102, 0.4);
    }
    .wa-float .wa-text {
      max-width: 0;
      overflow: hidden;
      white-space: nowrap;
      transition: max-width 0.5s ease;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .wa-float:hover .wa-text {
      max-width: 200px;
    }
    .wa-icon {
      width: 24px; height: 24px;
      display: flex; align-items: center; justify-content: center;
    }

    /* ‚îÄ‚îÄ DOUBT SCREEN ‚îÄ‚îÄ */
    .doubt-options {
      display: flex; flex-direction: column; gap: 10px;
      margin-top: 1.5rem;
    }
    .doubt-btn {
      display: flex; align-items: center; gap: 1rem;
      padding: 1.15rem 1.35rem;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.25s;
      text-decoration: none;
    }
    .doubt-btn:hover {
      background: var(--card-hover);
      border-color: var(--teal-border);
    }
    .doubt-btn.wa {
      background: rgba(37, 211, 102, 0.08);
      border-color: rgba(37, 211, 102, 0.2);
    }
    .doubt-btn.wa:hover {
      background: rgba(37, 211, 102, 0.14);
    }
    .doubt-icon {
      width: 44px; height: 44px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 12px;
      font-size: 1.3rem; flex-shrink: 0;
    }
    .doubt-btn.wa .doubt-icon { background: rgba(37,211,102,0.15); }
    .doubt-btn .doubt-icon { background: var(--teal-glow); }
    .doubt-text h4 { font-size: 0.95rem; font-weight: 700; color: var(--white); }
    .doubt-text p { font-size: 0.8rem; color: var(--slate); }

    /* ‚îÄ‚îÄ FAQ QUICK ‚îÄ‚îÄ */
    .faq-quick {
      margin-top: 2rem;
    }
    .faq-quick h3 {
      font-size: 0.78rem; font-weight: 700;
      color: var(--slate); letter-spacing: 0.1em;
      text-transform: uppercase; margin-bottom: 0.8rem;
    }
    .faq-item {
      padding: 0.9rem 0;
      border-bottom: 1px solid var(--divider);
      cursor: pointer;
    }
    .faq-q {
      font-size: 0.92rem; color: var(--white);
      font-weight: 600;
      display: flex; justify-content: space-between; align-items: center;
    }
    .faq-q span { color: var(--teal); transition: transform 0.3s; font-size: 1.1rem; }
    .faq-item.open .faq-q span { transform: rotate(45deg); }
    .faq-a {
      max-height: 0; overflow: hidden;
      transition: max-height 0.35s ease, padding 0.35s;
      font-size: 0.85rem; color: var(--slate);
      line-height: 1.6;
    }
    .faq-item.open .faq-a {
      max-height: 200px;
      padding-top: 0.6rem;
    }

    /* ‚îÄ‚îÄ SUCCESS ‚îÄ‚îÄ */
    .success-icon {
      width: 80px; height: 80px;
      margin: 0 auto 1.5rem;
      background: var(--teal-glow-strong);
      border: 2px solid var(--teal-border);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 2.2rem;
      animation: successPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) both;
    }
    @keyframes successPop {
      from { transform: scale(0); }
      to { transform: scale(1); }
    }
    .success-confetti {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 0.5rem;
      animation: confetti 0.6s ease both;
      animation-delay: 0.3s;
      opacity: 0;
    }
    @keyframes confetti {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ‚îÄ‚îÄ INLINE NOTICE ‚îÄ‚îÄ */
    .inline-notice {
      display: flex; align-items: flex-start; gap: 0.65rem;
      padding: 0.85rem 1rem;
      background: var(--teal-glow);
      border: 1px solid var(--teal-border);
      border-radius: 10px;
      margin: 1rem 0;
      font-size: 0.82rem; color: var(--teal-light);
    }
    .inline-notice .n-icon { flex-shrink: 0; font-size: 1rem; }

    /* ‚îÄ‚îÄ CHECKBOX ‚îÄ‚îÄ */
    .check-row {
      display: flex; align-items: flex-start; gap: 0.75rem;
      margin: 1rem 0;
      cursor: pointer;
    }
    .check-box {
      width: 22px; height: 22px; flex-shrink: 0;
      border: 2px solid var(--input-border);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
      margin-top: 0.1rem;
    }
    .check-row.checked .check-box {
      background: var(--teal); border-color: var(--teal);
    }
    .check-row.checked .check-box::after {
      content: '‚úì'; color: var(--navy-deep);
      font-size: 0.75rem; font-weight: 700;
    }
    .check-text {
      font-size: 0.85rem; color: var(--text); line-height: 1.5;
    }
    .check-text a { color: var(--teal); text-decoration: none; }

    /* ‚îÄ‚îÄ UTIL ‚îÄ‚îÄ */
    .mt-1 { margin-top: 1rem; }
    .mt-2 { margin-top: 2rem; }
    .text-center { text-align: center; }
    .text-sm { font-size: 0.82rem; }
    .text-xs { font-size: 0.72rem; }
    .text-slate { color: var(--slate); }
    .text-teal { color: var(--teal); }
  </style>
</head>
<body>


<!-- WhatsApp Float -->
<a href="https://wa.me/34634773958" target="_blank" class="wa-float group">
  <span class="wa-text">Falar no WhatsApp</span>
  <div class="wa-icon">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.94 3.659 1.437 5.634 1.437h.005c6.558 0 11.894-5.335 11.897-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
  </div>
</a>

<div class="funnel-wrap">

  <!-- Header -->
  <div class="funnel-header">
    <div class="funnel-logo">WEKO<span>TA</span></div>
    <div class="funnel-close" onclick="goTo('split')">‚úï</div>
  </div>

  <!-- Progress Bar -->
  <div class="progress-wrap" id="progressWrap">
    <div class="progress-steps" id="progressSteps">
      <div class="progress-dot" data-step="1"></div>
      <div class="progress-dot" data-step="2"></div>
      <div class="progress-dot" data-step="3"></div>
      <div class="progress-dot" data-step="4"></div>
      <div class="progress-dot" data-step="5"></div>
    </div>
    <div class="progress-label" id="progressLabel">Passo 1 de 5</div>
  </div>

  <!-- ============================================ -->
  <!-- SCREEN 0: SPLIT ‚Äî COMPRAR OU PERGUNTAR -->
  <!-- ============================================ -->
  <div class="screen active" id="screen-split">
    <div class="screen-title">Pronto para garantir o seu iPhone 17 Pro Max?</div>
    <div class="screen-sub">Junte-se a um grupo, pague presta√ß√µes fixas, receba o seu produto. <strong>Sem banco, sem juros, sem surpresas.</strong></div>

    <div class="split-choices">
      <button class="split-btn split-btn-primary" onclick="goTo('step1')">
        <span class="split-badge">üî• 4 posi√ß√µes restantes</span>
        <div class="split-icon">üöÄ</div>
        <div class="split-text">
          <h3>Quero garantir o meu</h3>
          <p>Inscri√ß√£o r√°pida em 3 minutos. Sem compromisso at√© confirmar.</p>
        </div>
      </button>

      <button class="split-btn split-btn-secondary" onclick="goTo('doubt')">
        <div class="split-icon">üí¨</div>
        <div class="split-text">
          <h3>Tenho d√∫vidas primeiro</h3>
          <p>Fale com a nossa equipa ou veja as perguntas frequentes.</p>
        </div>
      </button>
    </div>

    <div class="trust-bar">
      <div class="trust-item"><span class="trust-icon">üîí</span> Pagamentos seguros (EMI UE)</div>
      <div class="trust-item"><span class="trust-icon">üá™üá∫</span> Empresa europeia</div>
      <div class="trust-item"><span class="trust-icon">‚úì</span> 14 dias para desistir</div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- SCREEN DOUBT: D√öVIDAS -->
  <!-- ============================================ -->
  <div class="screen" id="screen-doubt">
    <div class="screen-title">Sem press√£o. Estamos aqui para ajudar.</div>
    <div class="screen-sub">Escolha o canal que preferir. Respondemos em minutos, n√£o em dias.</div>

    <div class="doubt-options">
      <a class="doubt-btn wa" href="https://wa.me/34634773958" target="_blank">
        <div class="doubt-icon">üí¨</div>
        <div class="doubt-text">
          <h4>WhatsApp</h4>
          <p>Resposta em menos de 15 minutos ¬∑ Seg-Sex 9h-20h</p>
        </div>
      </a>
      <a class="doubt-btn" href="#">
        <div class="doubt-icon">üìß</div>
        <div class="doubt-text">
          <h4>Email</h4>
          <p>contato@wekota.eu ¬∑ Resposta em at√© 24 horas</p>
        </div>
      </a>
      <a class="doubt-btn" href="#">
        <div class="doubt-icon">üìÑ</div>
        <div class="doubt-text">
          <h4>Condi√ß√µes do Programa</h4>
          <p>Tudo sobre como funciona, pre√ßo e direitos</p>
        </div>
      </a>
    </div>

    <div class="faq-quick">
      <h3>Perguntas r√°pidas</h3>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">Preciso de NIF ou conta banc√°ria portuguesa? <span>+</span></div>
        <div class="faq-a">N√£o. Basta ter passaporte v√°lido e residir em Portugal ou Espanha. Aceitamos transfer√™ncia internacional, cart√£o, MB Way, Bizum e d√©bito direto SEPA.</div>
      </div>
      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">√â seguro? E se algu√©m n√£o pagar? <span>+</span></div>
        <div class="faq-a">Os pagamentos s√£o custodiados por uma Institui√ß√£o de Moeda Eletr√≥nica licenciada na UE ‚Äî o seu dinheiro nunca passa pela WEKOTA. Temos um Fundo de Reserva que cobre atrasos de outros membros sem afetar a sua entrega.</div>
      </div>
      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">Quando recebo o meu produto? <span>+</span></div>
        <div class="faq-a">No m√™s correspondente √† sua posi√ß√£o no grupo. A WEKOTA atribui-lhe uma posi√ß√£o e informa-o antes de pagar ‚Äî se n√£o concordar, pode recusar sem custo.</div>
      </div>
      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">Posso desistir depois de aderir? <span>+</span></div>
        <div class="faq-a">Sim. Tem 14 dias para desistir sem motivo e sem custo, garantido pela lei europeia. Ap√≥s esse prazo, pode sair do grupo com reembolso proporcional.</div>
      </div>
      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">Qual √© o custo total? <span>+</span></div>
        <div class="faq-a">O pre√ßo do produto + 25% de taxa de servi√ßo, divididos em presta√ß√µes fixas. Zero surpresas. V√™ o valor exato da presta√ß√£o antes de assinar.</div>
      </div>
    </div>

    <button class="btn-primary mt-2" onclick="goTo('split')">‚Üê Voltar e aderir agora</button>
  </div>

  <!-- ============================================ -->
  <!-- STEP 1: DADOS B√ÅSICOS -->
  <!-- ============================================ -->
  <div class="screen" id="screen-step1">
    <div class="screen-title">Vamos come√ßar üëã</div>
    <div class="screen-sub">S√≥ precisamos do essencial. <strong>Demora menos de 1 minuto.</strong></div>

    <div class="form-group">
      <label class="form-label">Nome completo</label>
      <input class="form-input" type="text" placeholder="Como est√° no seu passaporte" />
    </div>
    <div class="form-group">
      <label class="form-label">Email</label>
      <input class="form-input" type="email" placeholder="seu@email.com" />
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Telem√≥vel</label>
        <input class="form-input" type="tel" placeholder="+351 900 000 000" />
      </div>
      <div class="form-group">
        <label class="form-label">Pa√≠s de resid√™ncia</label>
        <select class="form-select">
          <option value="">Selecionar</option>
          <option value="pt">üáµüáπ Portugal</option>
          <option value="es">üá™üá∏ Espanha</option>
        </select>
      </div>
    </div>

    <div class="inline-notice">
      <span class="n-icon">üîí</span>
      <span>Os seus dados est√£o protegidos pelo RGPD. Nunca partilhamos informa√ß√£o com terceiros para marketing.</span>
    </div>

    <button class="btn-primary" id="btn-step1">Continuar</button>
    <button class="btn-secondary" onclick="goTo('split')">‚Üê Voltar</button>
  </div>

  <!-- ============================================ -->
  <!-- STEP 2: PRODUTO + DURA√á√ÉO -->
  <!-- ============================================ -->
  <div class="screen" id="screen-step2">
    <div class="screen-title">O que quer adquirir?</div>
    <div class="screen-sub">Escolha o produto e a dura√ß√£o do grupo.</div>

    <label class="form-label">Produto</label>
    <div class="product-cards">
      <div class="product-card selected">
        <div class="pc-radio"></div>
        <div class="pc-info">
          <h4>iPhone 17 Pro Max 256GB</h4>
          <p>Cor Laranja ‚Äî <span class="pc-price">Desde ‚Ç¨75/m√™s</span></p>
        </div>
        <div class="pc-badge">Popular</div>
      </div>
    </div>

    <label class="form-label">Dura√ß√£o do grupo</label>
    <div class="duration-cards">
      <div class="dur-card" onclick="selectDur(this)">
        <div class="dur-months">12</div>
        <div class="dur-label">meses</div>
        <div class="dur-price">‚Ç¨149/m√™s</div>
        <div class="dur-price-label">Recebe mais r√°pido</div>
      </div>
      <div class="dur-card selected" onclick="selectDur(this)">
        <div class="dur-badge">Mais escolhido</div>
        <div class="dur-months">24</div>
        <div class="dur-label">meses</div>
        <div class="dur-price">‚Ç¨75/m√™s</div>
        <div class="dur-price-label">Presta√ß√£o mais baixa</div>
        <div class="dur-upgrade">‚≠ê Recebe sempre o modelo mais recente</div>
      </div>
    </div>

    <button class="btn-primary" id="btn-step2">Continuar</button>
    <button class="btn-secondary" onclick="goTo('step1')">‚Üê Voltar</button>
  </div>

  <!-- ============================================ -->
  <!-- STEP 3: KYC ‚Äî VERIFICA√á√ÉO DE IDENTIDADE -->
  <!-- ============================================ -->
  <div class="screen" id="screen-step3">
    <div class="screen-title">Verifica√ß√£o de identidade</div>
    <div class="screen-sub">Para seguran√ßa de todos os membros do grupo. <strong>R√°pido e confidencial.</strong></div>

    <input type="file" id="passport-upload" class="hidden" accept="image/*,.pdf" onchange="handleFileSelect(this, 'passport')">
    <div class="upload-zone" onclick="document.getElementById('passport-upload').click()">
      <div class="upload-icon" id="passport-icon">üõÇ</div>
      <h4 id="passport-title">Fotografia do passaporte</h4>
      <p id="passport-status">P√°gina com a foto. Aceite: JPG, PNG ou PDF.</p>
    </div>

    <input type="file" id="selfie-upload" class="hidden" accept="image/*" onchange="handleFileSelect(this, 'selfie')">
    <div class="upload-zone" onclick="document.getElementById('selfie-upload').click()">
      <div class="upload-icon" id="selfie-icon">ü§≥</div>
      <h4 id="selfie-title">Selfie de verifica√ß√£o</h4>
      <p id="selfie-status">Tire uma selfie segurando o passaporte.</p>
    </div>

    <div class="inline-notice">
      <span class="n-icon">üîí</span>
      <span>Os documentos s√£o armazenados de forma criptografada para verifica√ß√£o interna e nunca s√£o compartilhados.</span>
    </div>

    <button class="btn-primary" id="btn-step3">Verificar e continuar</button>
    <button class="btn-secondary" onclick="goTo('step2')">‚Üê Voltar</button>
  </div>

  <!-- ============================================ -->
  <!-- STEP 4: POSI√á√ÉO REVELADA + CONTRATO -->
  <!-- ============================================ -->
  <div class="screen" id="screen-step4">
    <div class="screen-title text-center">A sua posi√ß√£o no grupo</div>

    <div class="reveal-container">
      <div class="reveal-label">Posi√ß√£o atribu√≠da</div>
      <div class="reveal-ring">
        <div class="reveal-number" id="revealNum">7</div>
      </div>
      <div class="reveal-meaning">Recebe o seu iPhone no m√™s 7</div>
      <div class="reveal-detail">Grupo de 24 meses ¬∑ iPhone 17 Pro Max 256GB</div>
    </div>

    <div class="contract-summary">
      <div class="cs-row">
        <span class="cs-label">Produto</span>
        <span class="cs-value">iPhone 17 Pro Max 256GB</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">Grupo</span>
        <span class="cs-value">24 meses ¬∑ 24 membros</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">A sua posi√ß√£o</span>
        <span class="cs-value highlight-val">Posi√ß√£o 7 (m√™s 7)</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">Presta√ß√£o mensal</span>
        <span class="cs-value highlight-val" id="summary-price">‚Ç¨75,00/m√™s</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">Total</span>
        <span class="cs-value" id="summary-total">‚Ç¨1.800,00</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">Inclui taxa de servi√ßo</span>
        <span class="cs-value">25%</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">Garantia do produto</span>
        <span class="cs-value">Modelo mais recente na entrega ‚≠ê</span>
      </div>
    </div>

    <div class="check-row" onclick="toggleCheck(this)">
      <div class="check-box"></div>
      <div class="check-text">Li e aceito os <a href="/condicoes">Termos e Condi√ß√µes Gerais</a> e a <a href="/privacidade">Pol√≠tica de Privacidade</a>.</div>
    </div>

    <div class="check-row" onclick="toggleCheck(this)">
      <div class="check-box"></div>
      <div class="check-text">Compreendo que a propriedade do produto transfere-se para mim ap√≥s o pagamento da √∫ltima presta√ß√£o.</div>
    </div>

    <button class="btn-primary mt-1" onclick="goTo('step5')">Aceitar posi√ß√£o e continuar</button>
    <button class="btn-secondary" onclick="goTo('split')">Recusar posi√ß√£o</button>
    <p class="text-xs text-slate text-center mt-1">Se recusar, pode voltar mais tarde sem compromisso.</p>
  </div>

  <!-- ============================================ -->
  <!-- STEP 5: PAGAMENTO -->
  <!-- ============================================ -->
  <div class="screen" id="screen-step5">
    <div class="screen-title">Configure o pagamento</div>
    <div class="screen-sub">Escolha como quer pagar as presta√ß√µes mensais. <strong>A primeira presta√ß√£o √© cobrada quando o grupo iniciar.</strong></div>

    <label class="form-label">M√©todo de pagamento</label>
    <div class="pay-methods">
      <div class="pay-method selected" onclick="selectPay(this, 'card')">
        <div class="pay-icon">üí≥</div>
        <div class="pay-info">
          <h4>Cart√£o de d√©bito/cr√©dito</h4>
          <p>Visa ou Mastercard. Cobran√ßa autom√°tica mensal.</p>
        </div>
        <span class="pay-rec">Recomendado</span>
      </div>
      <div class="pay-method" onclick="selectPay(this, 'transfer')">
        <div class="pay-icon">üåç</div>
        <div class="pay-info">
          <h4>Transfer√™ncia internacional</h4>
          <p>Wise, Revolut ou transfer√™ncia SEPA manual.</p>
        </div>
      </div>
    </div>

    <!-- Bank Details for Transfer -->
    <div id="bankDetails" class="bank-details-box">
      <div class="bank-row">
        <span class="bank-label">Benefici√°rio</span>
        <div class="bank-val-wrap">
          <span class="bank-value">HEAVENWHISPER, UNIPESSOAL, LDA</span>
          <button class="copy-btn" onclick="copyText('HEAVENWHISPER, UNIPESSOAL, LDA', this)">Copiar</button>
        </div>
      </div>
      <div class="bank-row">
        <span class="bank-label">IBAN</span>
        <div class="bank-val-wrap">
          <span class="bank-value">LT64 3250 0598 6608 3915</span>
          <button class="copy-btn" onclick="copyText('LT643250059866083915', this)">Copiar</button>
        </div>
      </div>
      <div class="bank-row">
        <span class="bank-label">BIC/SWIFT</span>
        <div class="bank-val-wrap">
          <span class="bank-value">REVOLT21</span>
          <button class="copy-btn" onclick="copyText('REVOLT21', this)">Copiar</button>
        </div>
      </div>
      <div class="bank-row">
        <span class="bank-label">Moeda</span>
        <span class="bank-value">EUR</span>
      </div>
      <p class="text-[10px] text-slate mt-2 text-center">Envie o comprovativo para sales@wekota.eu ap√≥s a transfer√™ncia.</p>
    </div>

    <div class="inline-notice">
      <span class="n-icon">üîí</span>
      <span>Pagamentos via cart√£o s√£o processados de forma segura pelo Stripe. Para transfer√™ncias, a sua vaga √© garantida ap√≥s a recep√ß√£o do comprovativo.</span>
    </div>

    <button class="btn-primary" id="btn-final-pay">Confirmar ades√£o</button>
    <button class="btn-secondary" onclick="goTo('step4')">‚Üê Voltar</button>
  </div>

  <!-- ============================================ -->
  <!-- SUCCESS -->
  <!-- ============================================ -->
  <div class="screen" id="screen-success">
    <div class="success-confetti">üéâ</div>
    <div class="success-icon">‚úì</div>
    <div class="screen-title text-center">Bem-vindo ao grupo!</div>
    <div class="screen-sub text-center">A sua inscri√ß√£o est√° confirmada. Agora √© s√≥ esperar o grupo completar para o ciclo come√ßar.</div>

    <div class="contract-summary">
      <div class="cs-row">
        <span class="cs-label">Produto</span>
        <span class="cs-value">iPhone 17 Pro Max 256GB</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">A sua posi√ß√£o</span>
        <span class="cs-value highlight-val">Posi√ß√£o 7 de 24</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">Presta√ß√£o</span>
        <span class="cs-value highlight-val">‚Ç¨75,00/m√™s</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">Estado do grupo</span>
        <span class="cs-value">18 de 24 posi√ß√µes preenchidas</span>
      </div>
      <div class="cs-row">
        <span class="cs-label">Pr√≥ximo passo</span>
        <span class="cs-value">Notificamos quando o grupo iniciar</span>
      </div>
    </div>

    <div class="inline-notice">
      <span class="n-icon">üìß</span>
      <span>Envi√°mos o contrato assinado e o resumo da ades√£o para o seu email. Guarde-o para refer√™ncia.</span>
    </div>

    <button class="btn-primary" onclick="goTo('split')">‚Üê Voltar ao in√≠cio</button>

    <div class="trust-bar">
      <div class="trust-item"><span class="trust-icon">üì±</span> Acompanhe pelo WhatsApp</div>
      <div class="trust-item"><span class="trust-icon">üìß</span> Notifica√ß√µes por email</div>
    </div>
  </div>

</div>

<script>
  // Fallback global functions to ensure UI works even if module fails
  window.goTo = function(screenId) {
    console.log('Global goTo called:', screenId);
    const screens = document.querySelectorAll('.screen');
    screens.forEach(s => {
        s.classList.remove('active');
        s.style.display = 'none';
    });
    const target = document.getElementById('screen-' + screenId);
    if(target) {
        target.style.display = 'block';
        target.classList.add('active');
        window.scrollTo(0,0);
    }
  };
  window.selectDur = function(el) {
    document.querySelectorAll('.dur-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
  };
  window.selectPay = function(el, type) {
    document.querySelectorAll('.pay-method').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    
    const bankDetails = document.getElementById('bankDetails');
    if (type === 'transfer') {
      bankDetails.classList.add('active');
    } else {
      bankDetails.classList.remove('active');
    }
  };
  window.copyText = function(text, btn) {
    navigator.clipboard.writeText(text).then(() => {
      const originalText = btn.textContent;
      btn.textContent = 'Copiado!';
      btn.style.background = 'var(--teal)';
      btn.style.color = 'var(--navy-deep)';
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = 'var(--teal-glow)';
        btn.style.color = 'var(--teal)';
      }, 2000);
    });
  };
  window.simulateUpload = function(el) {
    el.classList.toggle('uploaded');
    if (el.classList.contains('uploaded')) {
      el.querySelector('h4').textContent = '‚úì Documento carregado';
      el.querySelector('p').textContent = 'Toque para substituir';
    }
  };
  window.toggleCheck = function(el) {
    el.classList.toggle('checked');
  };
  window.toggleFaq = function(el) {
    el.classList.toggle('open');
  };
</script>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
  import { loadStripe } from 'https://esm.sh/@stripe/stripe-js@2'

  const supabaseUrl = 'https://eczsqgtewtpcscsyvljy.supabase.co';
  const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjenNxZ3Rld3RwY3Njc3l2bGp5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NjUxNTAsImV4cCI6MjA1NjA4MTI1MH0.HTXvOSk4Gjbg85YPfmWB59wKD943-wyjFd-iWeF9BUk'; 
  
  const supabase = createClient(supabaseUrl, supabaseAnonKey);

  let currentLeadId = null
  let selectedPlanPriceId = 'price_1T4oKuEGWHer1k6ed8oBXVap'; 
  let assignedPosition = 0; // Nova vari√°vel para armazenar a posi√ß√£o vinda do admin

  // Nova Fun√ß√£o: Obter Posi√ß√£o do Admin
  async function fetchAssignedPosition(months) {
    try {
        const { data } = await supabase.from('funnel_settings').select('*').eq('id', 'current').single();
        if (data) {
            return months === '12' ? data.next_position_12_months : data.next_position_24_months;
        }
    } catch (e) { console.error('Erro ao buscar posi√ß√£o:', e); }
    return months === '12' ? 7 : 15; // Fallback
  }

  const forceNavigate = (screenId) => {
    console.log('Module forceNavigate:', screenId);
    const screens = document.querySelectorAll('.screen');
    screens.forEach(s => {
        s.classList.remove('active');
        s.style.display = 'none';
    });
    
    const target = document.getElementById('screen-' + screenId);
    if (target) {
        target.style.display = 'block';
        target.classList.add('active');
        target.style.animation = 'none';
        target.offsetHeight; 
        target.style.animation = 'screenIn 0.45s cubic-bezier(0.22, 0.61, 0.36, 1) both';
    }
    
    const pw = document.getElementById('progressWrap');
    if (screenId.startsWith('step')) {
        pw.classList.add('visible');
        const stepNum = parseInt(screenId.replace('step', ''));
        document.querySelectorAll('.progress-dot').forEach(d => {
            const s = parseInt(d.dataset.step);
            d.className = 'progress-dot';
            if (s < stepNum) d.classList.add('done');
            if (s === stepNum) d.classList.add('active');
        });
        const labels = {
            1: 'Dados pessoais',
            2: 'Produto e dura√ß√£o',
            3: 'Verifica√ß√£o de identidade',
            4: 'Posi√ß√£o e contrato',
            5: 'Pagamento'
        };
        const labelEl = document.getElementById('progressLabel');
        if(labelEl) labelEl.textContent = `Passo ${stepNum} de 5 ‚Äî ${labels[stepNum]}`;
    } else {
        if(pw) pw.classList.remove('visible');
    }
    window.scrollTo(0, 0);
  };

  window.goTo = forceNavigate;

  document.addEventListener('DOMContentLoaded', () => {
    // Initial setup if needed
    
    const btnStep1 = document.getElementById('btn-step1');
    if (btnStep1) {
      btnStep1.onclick = async (e) => {
        e.preventDefault();
        console.log('Step 1 Logic');
        
        const nameInput = document.querySelector('#screen-step1 input[type="text"]');
        const emailInput = document.querySelector('#screen-step1 input[type="email"]');
        
        if (!nameInput || !emailInput) {
            forceNavigate('step2');
            return;
        }

        const name = nameInput.value;
        const email = emailInput.value;
        const phone = document.querySelector('#screen-step1 input[type="tel"]')?.value || '';
        const country = document.querySelector('#screen-step1 select')?.value || '';

        if (!name || !email) {
          alert('Por favor, preencha Nome e Email.');
          return;
        }

        btnStep1.textContent = 'A guardar...';
        
        if (supabase) {
            try {
              const { data, error } = await supabase
                .from('leads')
                .insert([{ name, email, whatsapp: phone, country, status: 'started' }])
                .select()
              if (data && data.length > 0) currentLeadId = data[0].id;
            } catch (error) {
              console.error('Erro Supabase:', error);
            }
        }
        
        btnStep1.textContent = 'Continuar';
        forceNavigate('step2');
      };
    }

    const btnStep2 = document.getElementById('btn-step2');
    if (btnStep2) {
      btnStep2.onclick = async (e) => {
        e.preventDefault();
        const durEl = document.querySelector('.dur-card.selected .dur-months');
        const durationText = durEl ? durEl.textContent.trim() : '24';
        
        // 1. Buscar a posi√ß√£o configurada no ADMIN antes de avan√ßar
        assignedPosition = await fetchAssignedPosition(durationText);

        const summaryPrice = document.getElementById('summary-price');
        const summaryTotal = document.getElementById('summary-total');
        
        if (durationText === '12') {
            if(summaryPrice) summaryPrice.textContent = '‚Ç¨149,00/m√™s';
            if(summaryTotal) summaryTotal.textContent = '‚Ç¨1.788,00';
            selectedPlanPriceId = 'price_1T4oJhEGWHer1k6evF1y6zR5';
        } else {
            selectedPlanPriceId = 'price_1T4oKuEGWHer1k6ed8oBXVap';
            if(summaryPrice) summaryPrice.textContent = '‚Ç¨75,00/m√™s';
            if(summaryTotal) summaryTotal.textContent = '‚Ç¨1.800,00';
        }

        if (supabase && currentLeadId) {
            try {
                await supabase.from('leads').update({ 
                    plan: `iPhone 17 Pro Max - ${durationText} meses`, 
                    status: 'selected_plan',
                    assigned_position: assignedPosition // SALVA A POSI√á√ÉO NO LEAD
                }).eq('id', currentLeadId);
            } catch (e) {}
        }
        forceNavigate('step3');
      };
    }

    const btnStep3 = document.getElementById('btn-step3');
    if (btnStep3) {
      btnStep3.onclick = async (e) => {
        e.preventDefault();
        
        if (!filesToUpload.passport || !filesToUpload.selfie) {
          alert('Por favor, anexe ambos os documentos (Passaporte e Selfie) para continuar.');
          return;
        }

        btnStep3.textContent = 'A enviar documentos...';
        btnStep3.disabled = true;

        try {
          if (!supabase) throw new Error('Supabase n√£o dispon√≠vel.');
          if (!currentLeadId) throw new Error('Lead ID n√£o encontrado. Volte ao in√≠cio.');

          // 1. Upload Passport
          const passportPath = `${currentLeadId}/passport_${Date.now()}_${filesToUpload.passport.name}`;
          const { error: pError } = await supabase.storage
            .from('kyc-documents')
            .upload(passportPath, filesToUpload.passport);
          if (pError) throw pError;

          // 2. Upload Selfie
          const selfiePath = `${currentLeadId}/selfie_${Date.now()}_${filesToUpload.selfie.name}`;
          const { error: sError } = await supabase.storage
            .from('kyc-documents')
            .upload(selfiePath, filesToUpload.selfie);
          if (sError) throw sError;

          // 3. Update Lead Status and paths
          await supabase.from('leads').update({ 
            status: 'kyc_submitted',
            passport_url: passportPath,
            selfie_url: selfiePath
          }).eq('id', currentLeadId);

          // 4. Send email notification via Edge Function (Optional but recommended)
          await supabase.functions.invoke('send-kyc-notification', {
            body: { 
              lead_id: currentLeadId,
              email: 'wekotavip@gmail.com',
              passport_path: passportPath,
              selfie_path: selfiePath
            }
          });

          forceNavigate('step4');
        } catch (err) {
          console.error('Erro no KYC:', err);
          alert('Erro ao enviar documentos: ' + err.message + '. Certifique-se que o Bucket "kyc-documents" existe no seu Supabase.');
          btnStep3.textContent = 'Verificar e continuar';
          btnStep3.disabled = false;
        }
      };
    }

    const btnStep5 = document.querySelector('#screen-step5 .btn-primary');
    if (btnStep5) {
        btnStep5.onclick = async () => {
            const selectedMethodEl = document.querySelector('.pay-method.selected h4');
            const selectedMethodText = selectedMethodEl ? selectedMethodEl.innerText : '';
            
            if (selectedMethodText.includes('Cart√£o')) {
                btnStep5.textContent = 'A redirecionar...';
                btnStep5.disabled = true;
                
                try {
                    if (!supabase) throw new Error('Supabase n√£o dispon√≠vel.');
                    
                    console.log('Invocando checkout seguro via SDK oficial...');
                    
                    // Usando o SDK oficial que lida melhor com o JWT
                    const { data, error } = await supabase.functions.invoke('stripe-payments', {
                        body: { 
                            action: 'create-checkout-session',
                            lead_id: currentLeadId,
                            price_id: selectedPlanPriceId,
                            success_url: window.location.origin + '/funil-conversao.html?status=success',
                            cancel_url: window.location.origin + '/funil-conversao.html?status=cancel'
                        }
                    });

                    if (error) {
                        // Tentar extrair a mensagem de erro real do corpo da resposta
                        const details = error.context ? await error.context.json().catch(() => ({})) : {};
                        throw new Error(details.error || error.message || 'Erro na Edge Function');
                    }

                    if (data?.url) {
                        window.location.href = data.url;
                    } else {
                        throw new Error('O Stripe n√£o retornou um link de pagamento.');
                    }

                } catch (err) {
                    console.error('ERRO JWT/CHECKOUT:', err);
                    alert('Erro ao processar pagamento: ' + (err.message || 'Falha na autentica√ß√£o JWT. Verifique se a Anon Key est√° correta.'));
                    btnStep5.textContent = 'Confirmar ades√£o';
                    btnStep5.disabled = false;
                }
            } else {
                // Para Transfer√™ncia, vai direto para o sucesso
                forceNavigate('success');
            }
        };
    }

    const btnFinalPay = document.getElementById('btn-final-pay');
    if (btnFinalPay) {
        btnFinalPay.onclick = async () => {
            const selectedMethodEl = document.querySelector('.pay-method.selected h4');
            const selectedMethodText = selectedMethodEl ? selectedMethodEl.innerText : '';
            
            if (selectedMethodText.includes('Cart√£o')) {
                btnFinalPay.textContent = 'A redirecionar...';
                btnFinalPay.disabled = true;
                
                try {
                    if (!supabase) throw new Error('Supabase n√£o dispon√≠vel.');
                    
                    const payload = {
                        action: 'create-checkout-session',
                        lead_id: currentLeadId,
                        price_id: selectedPlanPriceId,
                        success_url: window.location.origin + '/funil-conversao.html?status=success',
                        cancel_url: window.location.origin + '/funil-conversao.html?status=cancel'
                    };

                    const { data, error } = await supabase.functions.invoke('stripe-payments', {
                        body: payload
                    });

                    if (error) throw error;
                    if (data?.url) {
                        window.location.href = data.url;
                    } else {
                        throw new Error('Fun√ß√£o n√£o retornou URL.');
                    }
                } catch (err) {
                    alert('Erro no checkout: ' + err.message);
                    btnFinalPay.textContent = 'Confirmar ades√£o';
                    btnFinalPay.disabled = false;
                }
            } else {
                // Para Transfer√™ncia, finaliza direto
                forceNavigate('success');
            }
        };
    }

    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('status') === 'success') forceNavigate('success');
  });
</script>

</body>
</html>